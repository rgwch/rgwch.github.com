---
layout: post
title: Asterisk Teil 1
description: Eine Telefonanlage
category: Administration
tags: [Server, admin, sip, telefon, asterisk]
---
## Eine neue Telefonanlage

ISDN wird per Ende 2017 eingestellt. Schon jetzt gibt es kaum noch brauchbare Endgeräte. Unsere Telefone spucken immer mal wieder, aber eine neue Anlage auf ISDN-Basis
lohnt sich definitiv nicht. Also was tun?

 * Eine Telefonanlage fürs Analognetz?
 * Eines der verschiedenen VOIP-Komplettangebote von Swisscom oder Sunrise?
 * Ein VirtualPBX
 * Eine selbstgebastelte PBX-Anlage auf Asterisk-Basis

Da dies ein Amateur-Blog ist, ist es klar, dass wir uns am Ende für die Bastel-Lösung entscheiden. Telefonanlagen fürs Analognetz sind zu teuer, aussserdem weiss
niemand, wie lange es das Anaolgnetz noch gibt. Die Angebote von Swisscom und Sunrise sind sehr schwierig zu verstehen. Ich brauche keinen Fernseher bei der ARbeit, aber dafürr mehrere Telefone
und die Möglichkeit, weiterzuverbinden und mehrere Nummern zu führen. Dafür braucht man dann die teuren Business-Varianten.

Für VirtualPBX gibt es Angebote z.B. von Swisscom, Sunrise, Sipcall, e-fon und VTX. Was mir dabei stinkt ist, dass keiner der Anbieter seine Preise auf der Website wirklich transparent offenlegt.
Alle behaupten gleichermassen, sie seien "günstig". Intensiveres Nachforschen bringt dann zu Tage, dass der Grundpreis wohl irgendwo zwischen 15 und 30 Franken pro Endgerät
und Monat liegt, Kosten für die Telefonnummern und Gespräche noch nicht eingerechnet. Zu teuer.



### Anforderungsprofil

Wir benötigen mindestens:

 * Vier Telefonnummern, davon eine Sammelnummer, eine Faxnummer und zwei Direktwahl-Nummern.
 * Vier Telefone, die alle auf die Sammelnummer hören, zwei sollen zusätzlich auf eine der Direktwahl-Nummern hören.
 * Ein Faxgerät, das auf die Faxnummer hört.
 * Zwei Anrufbeantworter.

Von jedem Telefon muss eine Weiterleitung auf jedes der anderen möglich sein, mit oder ohne Rückfrage.


### Asterisk

 Wer nach Telefonanlagen googelt, stösst früher oder später auf 'Asterisk'. Nein, damit ist nicht der kleine Gallier gemeint, der schreibt sich hinten mit x. Aber vermutlich ist der Anklang an dessen sprichwörtliche Schlauheit und Stärke nicht ganz unwillkommen. Ursprünglich stammt der Name aber von der Sterntaste ( * ) am Telefon. Die heisst nämlich so. Und sie dient dazu, erweiterte Telefonfunktionen anzusteuern.

 Hier soll es nun aber weder um Gallier noch um Telefontasten gehen, sondern um die PBX-Software Asterisk.
 Ich weiss, was Sie jetzt denken. Sie denken: "Was soll jetzt PBX  bedeuten?"
 Mit Abkürzungen werden Sie sich abfinden müssen. Sie Telefon-Leute scheinen nur per Abkürzungen miteinander zu reden. SOgar in Anfängerbüchern wird man mit Abkürzungen erschlagen.

PBX heisst 'Private Branch eXchange' und bedeutet frei übersetzt: 'Nebenstellenanlage'. Also eine Software zum Betreiben einer Telefon-Nebenstellenanlage.

Auf den ersten Blick genau das, was wir wollen. Und praktischerweise kostet Asterisk nichts (ausser Schweiss, Tränen und sehr viel Zeit).
Vielleicht wird dieser Artikel ja helfen, letztere etwas abzukürzen.

## Planung und Hardware

Asterisk läuft unter Linux, also brauchen wir einen Linux-Computer. Der Server im Keller würde sich anbieten, der läuft eh immer und ist eh nie ganz ausgelastet, und er läuft natürlich unter Linux.

Bei nochmaligem Nachdenken verliert diese Idee aber schnell an Glanz: Man will nicht wirklich, dass man bei einem Serverproblem auch gleich noch ohne Telefon dasteht. Und man will umgekehrt auch nicht, dass eine Asterisk-Fehlkonfiguration den Server in den Abgrund reisst.

Guter Rat ist hier ausnahmsweise billig: Ein Raspberry Pi Model 3 hat bei weitem ausreichend Power für eine Anlage mit bis zu ungefähr 10 parallelen Gesprächen. Er hat alle Anschlüsse, die man braucht, er ist billig, leise und sparsam. Und da er sehr einfach aufgebaut ist, gilt er allgemein auch als zuverlässig und langlebig.

Der Pi kommt irgendwo ans Netzwerk, eigentlich egal wo, aus praktischen Gründen stellen wir ihn einfach im Keller auf den Server.

Sonst brauchen wir eigentlich nichts. Später mal Telefone, aber für den Anfang tun es Soft-Phones. Ich komme nachher gleich darauf.

### Raspberry Pi aufsetzen

Am besten kauft man den Pi zusammen mit Gehäuse, Netzteil und vorkonfigurierter <abbr title="New Out Of the Box Software">NOOBS</abbr>-MicroSD. Dann passt gleich alles zusammen, und die Installation geht schnell, und man braucht nicht einmal Bildschirm und Tastatur an den Raspi anzuschliessen:

 * NOOBS-MicroSD an einen Desktop-Computer anschliessen, und die Datei 'recovery.cmdline' editieren: Am Ende 'silentinstall' (ohne die Anführungszeichen) anhängen. Im Ordner /os alles ausser 'raspbian' entfernen.
 * Die MicroSD in den Raspi einsetzen, LAN-Kabel und zuletzt Stromversorgung anschliessen. Sie werden nicht viel sehen oder hören, aber der Raspi installiert jetzt Raspbian und bootet anschliessend ins frisch installierte System. Gönnen Sie ihm etwa 5-10 Minuten Zeit dafür.
 * Finden Sie die IP-Adresse Ihres eben frisch installierten Raspi heraus. Am Sichersten geht das über die DHCP-Clientliste Ihres Routers. Sie können aber auch einfach mal `arp -a` probieren, das spuckt oft die Adresse schon aus. Oder, falls nmap installiert ist, `nmap -sP 192.168.0.*` (für die IP-Adresse natürlich Ihre echte Netzadresse eingeben).
 * Sobald Sie die Adresse wissen, können Sie mit `ssh pi@<raspi-adresse>` einloggen. Die Frage nach dem Passwort beantworten Sie mit `raspberry`. Und schon sind Sie 'drin'.
 * Als Erstes würde ich empfehlen, dass Passwort zu ändern. Sie werden nicht wollen, dass später jeder in Ihre Telefonzentrale einbrechen kann, weil Sie bei der Installation nicht mehr an diesen Schritt gedacht haben. Das Kommando dazu heisst `passwd`.
 * Bevor Sie zu Ihrem wohlverdienten Kaffee kommen, sollten Sie die folgenden Kommandos absetzen: `sudo apt-get update && sudo apt-get upgrade -y` Danach ist der Raspi ein halbes Stündchen oder so mit Updates beschäftigt.

 In der nächsten Folge wird Asterisk installiert.
